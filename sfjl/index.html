<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>签约对象随访记录</title>
    <script src="js/mui.min.js"></script>
	<script src="js/mui.picker.min.js"></script>
	<link href="css/mui.min.css" rel="stylesheet"/>
	<link href="css/mui.picker.min.css" rel="stylesheet"/>
    <link href="css/css.css" rel="stylesheet"/>

</head>
<body>
	<ul class="contract-box">
		<li>签约对象<p class="user-name">小明</p></li>
		<li data-options='{"type":"date"}' class="sftime">随访时间<p data-options='{"type":"date"}' class="selectdate">选择日期</p><em></em></li>
		<li>随方医生<p class="doctor-name">小红</p></li>
		<li id="last">随访方式<p id='showUserPicker'>请选择随访方式</p><em></em></li>
	</ul>
	<div class="remarks">
		<label><img src="images/remarks.png" ></label><p>随访内容</p>
		<textarea rows="" cols="" placeholder="请输入随访内容..."></textarea>
	</div>
	<script>
		(function($) {
			$.init();
			var result = $('.selectdate')[0];
			var btns = $('.sftime');
			btns.each(function(i, btn) {
				btn.addEventListener('tap', function() {
					var _self = this;
					if(_self.picker) {
						_self.picker.show(function (rs) {
							result.innerText = rs.text;
							_self.picker.dispose();
							_self.picker = null;
						});
					} else {
						var optionsJson = this.getAttribute('data-options') || '{}';
						var options = JSON.parse(optionsJson);
						var id = this.getAttribute('id');
						/*
						* 首次显示时实例化组件
						* 示例为了简洁，将 options 放在了按钮的 dom 上
						* 也可以直接通过代码声明 optinos 用于实例化 DtPicker
						*/
						_self.picker = new $.DtPicker(options);
						_self.picker.show(function(rs) {
							/*
							* rs.value 拼合后的 value
							* rs.text 拼合后的 text
							* rs.y 年，可以通过 rs.y.vaue 和 rs.y.text 获取值和文本
							* rs.m 月，用法同年
							* rs.d 日，用法同年
							* rs.h 时，用法同年
							* rs.i 分（minutes 的第二个字母），用法同年
							*/
							result.innerText = rs.text;
							/* 
							* 返回 false 可以阻止选择框的关闭
							* return false;
							*/
							/*
							* 释放组件资源，释放后将将不能再操作组件
							* 通常情况下，不需要示放组件，new DtPicker(options) 后，可以一直使用。
							* 当前示例，因为内容较多，如不进行资原释放，在某些设备上会较慢。
							* 所以每次用完便立即调用 dispose 进行释放，下次用时再创建新实例。
							*/
							_self.picker.dispose();
							_self.picker = null;
						});
					}
					
				}, false);
			});
		})(mui);
		(function($, doc) {
			$.init();
			$.ready(function() {
				/**
				* 获取对象属性的值
				* 主要用于过滤三级联动中，可能出现的最低级的数据不存在的情况，实际开发中需要注意这一点；
				* @param {Object} obj 对象
				* @param {String} param 属性名
				*/
				var _getParam = function(obj, param) {
					return obj[param] || '';
				};
				//普通示例
				var userPicker = new $.PopPicker();
				userPicker.setData([{
					value: 'ywj',
					text: '电话随访'
				}, {
					value: 'aaa',
					text: '面对面随访'
				}]);
				var showUserPickerButton = doc.getElementById('last');
				var userResult = doc.getElementById('showUserPicker');
				showUserPickerButton.addEventListener('tap', function(event) {
					userPicker.show(function(items) {
						userResult.innerText = JSON.stringify(items[0].text).substring(1,JSON.stringify(items[0].text).length-1)
						//返回 false 可以阻止选择框的关闭
						//return false;
					});
				}, false);
			});
		})(mui, document);
	</script>
</body>
</html>